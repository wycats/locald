# READ-ONLY: Use 'exo' CLI to modify this file.
# Implementation Plan

[phase]
id = "111"
title = "CLI Surface Audit + Enforcement"
rfcs = ["0112", "0114"]

[plan]

[[plan.changes]]
name = "Generate CLI surface manifest"
type = "chore"
details = "Add a deterministic, machine-readable CLI surface manifest generator (driven from the clap command definitions) and check in the generated JSON so changes are reviewable in PRs. The generator itself should be an internal-only surface; the manifest becomes the stable input for docs/CI linting."
files = ["locald-cli/src/cli.rs", "locald-cli/src/surface_manifest.rs", "docs/surface/cli-manifest.json"]
tests = []
satisfies = ["111.1"]
no_test_reason = "Tooling-only; validated via CI check that regenerates and diffs"

[[plan.changes]]
name = "Docs lint against CLI manifest"
type = "chore"
details = "Add a docs linter that scans user-facing docs (at minimum locald-docs content plus root README) for referenced locald commands and options and fails if they are not present in the CLI manifest. Scope linting to taught surfaces (primarily shell/bash code blocks) to minimize false positives."
files = ["scripts/check-cli-surface-docs.mjs", "README.md", "locald-docs/src/content/docs/getting-started/index.mdx", "locald-docs/src/content/docs/reference/cli.md"]
tests = []
satisfies = ["111.2"]
no_test_reason = "Tooling-only; exercised in CI"

[[plan.changes]]
name = "CI checks for drift"
type = "chore"
details = "Wire manifest regeneration and docs lint into CI so drift is caught automatically. CI must fail if (a) the checked-in CLI manifest is out of date, or (b) docs reference commands/options not present in the manifest."
files = [".github/workflows/ci.yml", "scripts/check", "docs/surface/cli-manifest.json"]
tests = []
satisfies = ["111.3"]
no_test_reason = "CI-only"

[verification]
automated = ["Run scripts/verify-phase.sh"]
manual = []
